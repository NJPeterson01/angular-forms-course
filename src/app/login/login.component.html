
<!-- Template Driven Form -->

<!-- 
  Issue with template driven forms, data manipulation is done in the HTML. 
  This creates a lot of HTML and doesn't cover all use cases and doesn't scale
  well.
-->
<mat-card class="login-page">
  <mat-card-title>Login</mat-card-title>
  <mat-card-content>

    <!--
      Regardless of the HTML you use, there is no 'security' on the UI. You must validate 
      all rules the UX uses on the backend as well. UX is just the user experience. 
    -->

    <!-- 
      Using the '#' tag creates a reference that HTML elements can find.
      In this case, we attached all the functions of 'ngForm' to the tag. 
      ngForm will track any ngModel directive inside of it.

      Any value that emits an invalid flag will make the entire form invalid.

      Common CSS Flags in Angular:
      Untouched / Touched: If field was selected by user (user interaction)
      Pristine / Dirty: If field has had its value modified  (data change)
      Valid / Invalid: If field has a triggered flag for validity (validity)

      Putting 'ngSubmit' on the parent form gives us access to the form events.
      We could also just use a click bind on a button.
    -->
    <form class="login-form" #loginForm="ngForm" (ngSubmit)="login(loginForm, $event)">

      <mat-form-field>

        <!-- 
          ngModel directive will link this to the form directive and track any changes
          Models require a name in order to be reference directly

          'required', 'email', 'minlength', 'maxlength', and 'pattern' are standard HTML validators. 
          These apply certain CSS classes to the object.

          Pattern uses standard javascript regex

          'ngModelOptions' allows you to control when a value is emitted from an ngModel object. (Not used very often)

          'name' (string) -> Name of object (similar to using 'name' property). This will override any given name.
          'updateOn' (string) -> When value should be emitted
          'standalone' (bool) -> Allows form control to work outside of form. Parent form will no longer be updated
        
          Some possible values for 'updateOn': 
            'blur' -> when user tab aways, 
            'change' -> when value changes, 
            'submit' -> when form is submitted 
        -->
        <!--
        <input matInput type="email" name="email" 
          ngModel 
          #email="ngModel" 
          [ngModelOptions]="{name: 'Email', updateOn: 'blur'}"
          (ngModelChange)="onEmailChange($event)"
          required 
          email
          minlength="3"
          maxlength="20"
          placeholder="Email">
        -->
        <input matInput type="email" name="email" 
          [ngModel]
          #email="ngModel"
          required 
          email
          minlength="3"
          maxlength="20"
          placeholder="Email">

        <!-- Displays an error if the field is in error -->
        <mat-error *ngIf="email.errors?.required">The email is mandatory</mat-error>

        <mat-error *ngIf="email.errors?.minlength">
          You email must be {{email.errors?.minlength.requiredLength}} chars
          but it only has {{email.errors?.minlength.actualLength}}.
        </mat-error>

        <mat-error *ngIf="email.errors?.email">This is not a valid email</mat-error>

      </mat-form-field>

      <mat-form-field>

        <input matInput type="password" name="password" 
          [ngModel]
          passwordStrength
          minlength="8"
          #password="ngModel" 
          required 
          placeholder="Password">

          <mat-error *ngIf="password.errors?.required">
            Password cannot be empty!
          </mat-error>

      </mat-form-field>

      <!-- 
        Pipes can take imput arguments. 'Required' is not needed as it
        overrides the other two by default.
      -->
      <ng-container *ngIf="password.errors | onlyOneError:['minlength','passwordStrength'] as error">

        <div class="field-message" *ngIf="error?.minlength">
          Email must be at least {{error?.minlength.requiredLength}} characters
        </div>

        <div class="field-message" *ngIf="error?.passwordStrength">
          Your password must have an uppercase, lowercase, and numeric value!
        </div>
      </ng-container>

      <!-- 
        'Submit' is a type used to post an entire form in standard HTML on click.
        We don't want that here. Instead, we will catch it with 'ngSubmit'
        on the form parent so we can apply our own logic in Typescript.  
       -->
      <button mat-raised-button color="primary" type="submit" 
        [disabled]="!loginForm.valid">
        Login
      </button>

    </form>

    <div class="form-val">
      {{ password.errors | json }}
    </div>

  </mat-card-content>
</mat-card>